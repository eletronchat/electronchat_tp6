<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>微讯智能客服系统</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="./static/layui/src/css/layui.css" media="all">
  <script>
  /^http(s*):\/\//.test(location.href) || alert('请先部署到 localhost 下再访问');
  </script>
</head>
<body>
  <div id="LAY_app" class="layadmin-side-shrink"></div>
  <script src="./static/layui/src/layui.js"></script>
  <link rel="stylesheet" href="./style/dtree/dtree.css">
  <link rel="stylesheet" href="./style/dtree/font/dtreefont.css">
  <link rel="stylesheet" href="./style/chat/index.css">
  <link rel="stylesheet" href="./style/layim/layim.css">
  <script>
  layui.config({
    base: './' //指定 layuiAdmin 项目路径
    ,version: new Date().getTime()
    ,app_name: '微讯智能客服系统'
    ,app_des: '中小企业智能客服解决方案'
    ,rest_url: '/api/v1' //REST api接口基地址
  }).use(['index', 'post'], function(){
    var layer = layui.layer
       ,admin = layui.admin
       ,post  = layui.post;
    
    const socket = new WebSocket('ws://' + location.href.split('/')[2] + ':8282'); 
    socket.addEventListener('open', function(event) {
        socket.send(
          JSON.stringify({ 
            from: '/local/chat',
            to: '/service/login',
            time: (new Date().valueOf()),
            data: {'access-token': layui.data('layuiAdmin')['access-token']} 
          })
        );
    }) 
    //接收本地的消息并转发 
    post.inbox({
      from: '/local/chat', 
      onMessage: function(e) {
        console.log('这里是入口文本，现收到来自' +e.from+ '的消息,内容：'+ JSON.stringify(e.data)); 
      }
    });
    /*layer.ready(function(){
      admin.popup({
        content: '单页面专业版默认未开启“多标签”功能，实际运用时，你可以自定义是否开启'
        ,area: '300px'
        ,btnAlign: 'c'
        ,shade: false
      });
    });*/
  });
  </script>
</body>
</html>
